## GPIO端口

---

*资料来源：*[GPIO输入输出模式原理(八种工作方式附电路图详解)_gpio四种输入输出模式-CSDN博客](https://blog.csdn.net/zhuguanlin121/article/details/118489092)



GPIO（General-purpose input/output）是单片机上设计的通用输入输出端口，它们与芯片封装的引脚相关联。作为单片机上通用输入和输出的端口，其特性在与可以通过编程配置寄存器，来实时的设置和控制引脚的输入或是输出，同时更改与GPIO状态相关的寄存器还可以设置GPIO的特殊输出或者输入状态以及硬件上为其设计好的复用功能

#### GPIO的硬件结构

![img](https://img-blog.csdn.net/20180408224319518)

从图中不难看出，输出部分的通路中由两个寄存器控制输出信息的内容，与复用功能输出相并，通过选择控制输出的模式。再向外的输出通路配置有一对P-MOS和N-MOS使得GPIO的输出具有推挽和开漏的功能，并且在连接到封装引脚之前还有一对保护二极管能够保护引脚上的异常电压对电路的破坏。

输入部分类似的，共用保护二极管进入通路，有一对上拉和下拉的开关控制支路，为输入部分电路提供上拉和下拉的输入功能。再向内侧的输入部分可以自主选择两条分路——通过TTL肖特基触发器将模拟输入转换为稳定的高低电平，或者不通过肖特基触发器直接将模拟输入导入片上（这一功能为单片机的ADC功能提供基础）

#### GPIO的输入输出模式

以STM32F103为例，其允许我们配置GPIO的输入输出模式共8种，其中输入输出各四种，分别有各自的特点和应用场景

| 输入模式 | 特点                                                       | 输出模式     | 特点                                             |
| -------- | ---------------------------------------------------------- | ------------ | ------------------------------------------------ |
| 模拟输入 | 将外界的输入信号不通过肖特基触发器直接接入片上             | 开漏输出     | 输出低电平正常，但输出高电平需要依靠外部上拉电路 |
| 浮空输入 | 同时关闭上拉下拉两条分路，直接接入肖特基触发器变为电平信号 | 推挽输出     |                                                  |
| 上拉输入 | 初始化为高电平，依靠外界低电平拉低                         | 复用开漏输出 | 同开漏输出相似，输出源改成片上复用输出源         |
| 下拉输入 | 初始化为低电平，依靠外界高电平拉高                         | 复用推挽输出 |                                                  |

##### 上拉输入

上拉输入的配置要求闭合上拉通路的开关，断开下拉通路的开关，同时不打开模拟输入开关

当外界输入断开时，导入肖特基触发器的是来自上拉通路VDD流经上拉电阻的高电平，故使得输入信号默认为高电平；只有当外界接入低电平时，VDD流经上拉电阻从端口流出的通路建立，导入肖特基触发器的为低电平

##### 下拉输入

与上拉输入的配置相似，只保持闭合下拉通路的开关，默认导通的是从VSS导入低电平的下拉分路，需要依靠外界的高电平将信号拉高至高电平

##### 浮空输入

浮空输入同时断开上拉与下拉分路的开关，未接外部信号时即不受到上拉也不受到下拉，有些类似高阻态的模式

##### 模拟输入

模拟输入同浮空输入类似，但不通过肖特基触发器，将外部的没有经过上下拉的信号直接导入片上，是几种输入模式中最能持外界信号携带信息的一种模式

##### 开漏输出

开漏输出的配置规定**来自输出寄存器的电平信号只负责控制N-MOS管的导通**，而N-MOS管只连接GND和输出端口，故而当输出寄存器为高电平时，N-MOS被控制截止，本该输出高电平的端口没有通路，故在**开漏输出模式下输出高电平需要依靠外界上拉电阻来实现**。而当寄存器上为低电平时，N-MOS管受控导通，输出端口直接与GND导通，正常输出低电平

##### 复用开漏输出

复用开漏输出模式配置和开漏输出基本一致，只是将输出的信号源改成片上其他外设提供的复用输出，输出信号的性质和开漏输出一致

##### 推挽输出

推挽输出是在开漏输出的基础上，同时将N-MOS和P-MOS利用起来，用输出电平信号同时控制两个MOS管的导通，从而实现输出电平为高时控制P-MOS管导通将输出和VDD联通，而输出为低电平时N-MOS管导通控制输出和GND相连，这种模式在输出高低电平都具有较好的带载能力

##### 复用推挽输出

复用推挽输出相比推挽输出和复用开漏输出相比开漏输出相似，将CPU上寄存器的输出改为片上其他外设的输出

> 4种输出模式都能够同时打开输入通道的肖特基触发器，从而实现同时输出电平和读取电平

在实际配合外设或者某种特定功能实现时，应该根据8种输入输出模各自具有的优缺点选择